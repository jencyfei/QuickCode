# 快递取件码调试功能 - JSON格式说明 - 2025-11-18

## 🎯 调试功能更新

快递取件码页面的调试功能已更新，现在**原始短信数据以JSON格式显示**，保持程序获取短信的数据结构不变。

---

## 📋 JSON格式说明

### 原始短信数据格式

```json
[
  {
    "收信时间": "2025-11-18T09:15:00",
    "发信号码": "菜鸟驿站",
    "短信内容": "【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。"
  },
  {
    "收信时间": "2025-11-18T08:30:00",
    "发信号码": "SF",
    "短信内容": "【顺丰快递】您的包裹已到达，取件码：2-4-2029，请到郑州市中原区取件。"
  },
  {
    "收信时间": "2025-11-18T07:45:00",
    "发信号码": "中通",
    "短信内容": "【中通快递】您有1个包裹在中通驿站，凭9-6-3012到郑州市金水区中通驿站取件。"
  }
]
```

### 字段说明

| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| **收信时间** | String | 短信接收时间（ISO 8601格式） | `2025-11-18T09:15:00` |
| **发信号码** | String | 短信发送者（号码或名称） | `菜鸟驿站` 或 `10086` |
| **短信内容** | String | 短信的完整内容 | `【菜鸟驿站】您的包裹已到站...` |

---

## 🔍 如何使用调试信息

### 步骤1：打开调试对话框

1. 打开快递取件码页面
2. 点击右上角的设置按钮（⚙️）
3. 弹出调试对话框

### 步骤2：查看原始短信数据

- 对话框顶部显示"=== 原始短信数据 (JSON格式) ==="
- 下面是JSON数组，包含前10条短信
- 每条短信都是一个JSON对象，包含三个字段

### 步骤3：查看提取结果

- 对话框中间显示"=== 提取结果 ==="
- 下面是从短信中提取的快递信息
- 包含快递公司、取件码、日期等信息

### 步骤4：复制调试信息

- 点击"复制"按钮
- 将所有信息复制到剪贴板
- 可以粘贴到文本编辑器或邮件中

---

## 💡 诊断问题的方法

### 问题1：取件码识别错误

**示例**:
```json
{
  "收信时间": "2025-11-18T09:15:00",
  "发信号码": "菜鸟驿站",
  "短信内容": "【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。"
}
```

**问题**: 原始短信中的取件码是 `6-5-5011`，但程序识别为 `5011`

**诊断步骤**:
1. 复制短信内容
2. 查看提取结果中的取件码
3. 对比两者，找出差异
4. 修复提取规则

---

### 问题2：日期识别错误

**示例**:
```json
{
  "收信时间": "2025-11-18T09:15:00",
  "发信号码": "菜鸟驿站",
  "短信内容": "【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。"
}
```

**问题**: 短信中没有明确的日期，但程序识别出了错误的日期

**诊断步骤**:
1. 查看短信内容中是否有日期信息
2. 查看提取结果中的提取日期
3. 检查是否有日期提取规则匹配
4. 根据需要调整或添加新规则

---

### 问题3：地址识别失败

**示例**:
```json
{
  "收信时间": "2025-11-18T09:15:00",
  "发信号码": "菜鸟驿站",
  "短信内容": "【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。"
}
```

**问题**: 原始短信中有明确的地址"郑州市北文雅小区6号楼102店"，但提取结果中显示为"未提取"

**诊断步骤**:
1. 查看短信内容中的地址信息
2. 查看提取结果中的地址字段
3. 检查是否有地址提取规则匹配
4. 根据需要添加新的地址格式规则

---

## 📊 完整的调试信息示例

```
=== 原始短信数据 (JSON格式) ===
[
  {
    "收信时间": "2025-11-18T09:15:00",
    "发信号码": "菜鸟驿站",
    "短信内容": "【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。"
  },
  {
    "收信时间": "2025-11-18T08:30:00",
    "发信号码": "SF",
    "短信内容": "【顺丰快递】您的包裹已到达，取件码：2-4-2029，请到郑州市中原区取件。"
  },
  {
    "收信时间": "2025-11-18T07:45:00",
    "发信号码": "中通",
    "短信内容": "【中通快递】您有1个包裹在中通驿站，凭9-6-3012到郑州市金水区中通驿站取件。"
  }
]

=== 提取结果 ===
总快递数: 3

【快递 1】
快递公司: 菜鸟驿站
取件码: 6-5-5011
提取日期: 2025-11-5
地址: 郑州市北文雅小区6号楼102店
发件人: 菜鸟驿站
接收时间: 2025-11-18T09:15:00
取件状态: PENDING
原始短信: 【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。

【快递 2】
快递公司: SF
取件码: 2-4-2029
提取日期: 2025-11-4
地址: 郑州市中原区
发件人: SF
接收时间: 2025-11-18T08:30:00
取件状态: PENDING
原始短信: 【顺丰快递】您的包裹已到达，取件码：2-4-2029，请到郑州市中原区取件。

【快递 3】
快递公司: 中通
取件码: 9-6-3012
提取日期: 2025-11-6
地址: 郑州市金水区中通驿站
发件人: 中通
接收时间: 2025-11-18T07:45:00
取件状态: PENDING
原始短信: 【中通快递】您有1个包裹在中通驿站，凭9-6-3012到郑州市金水区中通驿站取件。
```

---

## 🛠️ 如何修复识别问题

### 修复取件码识别

**文件**: `ExpressExtractor.kt`

**方法**: `extractPickupCode()` 或 `extractAllPickupCodes()`

**步骤**:
1. 从JSON中复制短信内容
2. 在 `ExpressExtractor.kt` 中找到相应的提取方法
3. 添加新的正则表达式规则
4. 测试新规则
5. 重新编译应用

**示例**:
```kotlin
// 添加新的取件码提取规则
val newPattern = Pattern.compile("凭(\\d+-\\d+-\\d+)")
val matcher = newPattern.matcher(content)
if (matcher.find()) {
    return matcher.group(1)
}
```

### 修复日期识别

**文件**: `ExpressExtractor.kt`

**方法**: `extractDate()`

**步骤**:
1. 从JSON中复制短信内容
2. 在 `extractDate()` 方法中添加新的日期格式规则
3. 测试新规则
4. 重新编译应用

**示例**:
```kotlin
// 添加新的日期格式规则
val newDatePattern = Pattern.compile("(\\d{1,2})月(\\d{1,2})日")
val matcher = newDatePattern.matcher(content)
if (matcher.find()) {
    val month = matcher.group(1)
    val day = matcher.group(2)
    return "$currentYear-$month-$day"
}
```

### 修复地址识别

**文件**: `ExpressExtractor.kt`

**方法**: `extractLocation()`

**步骤**:
1. 从JSON中复制短信内容
2. 在 `extractLocation()` 方法中添加新的地址格式规则
3. 测试新规则
4. 重新编译应用

**示例**:
```kotlin
// 添加新的地址格式规则
val newLocationPattern = Pattern.compile("到([^，。]*?(?:小区|楼|店)[^，。]*)")
val matcher = newLocationPattern.matcher(content)
if (matcher.find()) {
    return matcher.group(1).trim()
}
```

---

## 📝 JSON格式的优点

1. **结构清晰** - 易于理解数据格式
2. **易于解析** - 可以用JSON解析工具验证
3. **易于对比** - 可以直接对比原始数据和提取结果
4. **易于导出** - 可以直接导出到JSON文件
5. **易于共享** - 可以分享给开发者进行分析

---

## 🎯 常见问题

### Q: JSON格式中的字段名是中文，这是为什么？
A: 为了更清晰地表示字段含义，使用了中文字段名。这样可以直观地看到"收信时间"、"发信号码"、"短信内容"等信息。

### Q: 如何验证JSON格式是否正确？
A: 可以将JSON内容复制到在线JSON验证工具（如 jsonlint.com）进行验证。

### Q: 如何导出JSON数据到文件？
A: 点击"复制"按钮，将数据复制到文本编辑器，保存为 `.json` 文件。

### Q: 如何在代码中使用这个JSON数据？
A: 可以使用 Gson 或其他JSON库解析这个JSON数据，然后进行分析。

---

## 📌 总结

调试功能现在提供了以下能力：
- ✅ 查看程序读取的原始短信数据（JSON格式）
- ✅ 保持程序获取短信的数据结构不变
- ✅ 包含收信时间、发信号码、短信内容三个关键字段
- ✅ 易于对比原始数据和提取结果
- ✅ 易于诊断和修复识别问题

通过这个调试功能，可以快速诊断和修复取件码识别问题。

