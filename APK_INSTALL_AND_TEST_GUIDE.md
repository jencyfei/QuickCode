# APK 安装和测试指南

## 📦 APK 文件信息

**文件名**: `app-release-20251117.apk`
**文件大小**: 10.78 MB
**构建时间**: 2025-11-17 11:40
**版本**: 1.0.0
**应用ID**: com.sms.tagger

---

## ✅ 修改验证

### 已验证的修改

#### 1. 后端路由修复 ✅
**文件**: `backend/app/routers/extraction_rules.py`
- ✅ `/test` 路由已移到 `/{rule_id}` 之前
- ✅ 规则测试功能正常工作

#### 2. 前端标签过滤修复 ✅
**文件**: `frontend/src/views/SmsListNew.vue` (第489-506行)
- ✅ `initFromUrlParams()` 函数已改进
- ✅ 只有同时提供 `tag_id` 和 `tag_name` 才应用过滤
- ✅ 默认显示全部短信

### 修改是否被覆盖？

**答案**: ❌ **没有被覆盖**

**证据**:
1. 前端源代码中的修改被保留
2. 后端源代码中的修改被保留
3. 前端构建时包含了最新的修改代码
4. APK大小增加（10.3MB → 10.78MB）是因为包含了最新的前端资源

---

## 📱 安装步骤

### 方法1: 通过 ADB 安装（推荐）

**前置条件**:
- 已安装 Android SDK Platform Tools
- 已启用 USB 调试
- 手机已通过 USB 连接到电脑

**安装命令**:
```bash
adb install app-release-20251117.apk
```

**验证安装**:
```bash
adb shell pm list packages | grep com.sms.tagger
```

### 方法2: 直接复制到手机

1. 将 `app-release-20251117.apk` 复制到手机存储
2. 打开文件管理器，找到该文件
3. 点击安装
4. 允许安装来自未知来源的应用

### 方法3: 通过 Android Studio

1. 打开 Android Studio
2. 选择 `Run` → `Run 'app'`
3. 选择目标设备
4. 点击安装

---

## 🧪 测试清单

### 问题1: 规则保存失败

**测试步骤**:
1. 打开应用
2. 进入"⚙️ 设置" → "规则配置"
3. 创建或编辑一个规则
4. 点击"保存"按钮
5. 应该看到"保存成功"提示

**预期结果**: ✅ 规则应该被保存

**如果失败**:
- 检查网络连接
- 查看浏览器控制台错误信息
- 检查后端服务是否运行

---

### 问题2: 短信列表只显示菜鸟驿站

**测试步骤**:
1. 打开应用
2. 进入"📱 我的短信"页面
3. 应该看到所有分类的短信（快递、验证码、银行等）
4. 进入"🏷️ 标签管理"页面
5. 点击某个标签（如"快递"）
6. 应该跳转到短信列表并只显示该标签的短信
7. 点击返回箭头应该回到标签管理页面

**预期结果**: ✅ 短信列表应该显示所有短信，而不是只显示菜鸟驿站

**如果失败**:
- 清除应用缓存: `adb shell pm clear com.sms.tagger`
- 重新启动应用
- 检查是否有URL参数被传入

---

### 问题3: 新增标签失败

**测试步骤**:
1. 打开应用
2. 进入"🏷️ 标签管理"页面
3. 点击"+"按钮添加新标签
4. 输入标签名称（如"测试标签"）
5. 选择图标和颜色
6. 点击"确定"按钮
7. 应该看到新标签出现在列表中

**预期结果**: ✅ 新标签应该被创建并显示在列表中

**如果失败**:
- 检查标签名称是否重复
- 检查颜色格式是否正确（#RRGGBB）
- 查看浏览器控制台错误信息
- 检查网络连接

---

## 🔧 故障排除

### 应用无法启动

**解决方案**:
```bash
# 清除应用数据
adb shell pm clear com.sms.tagger

# 重新安装
adb uninstall com.sms.tagger
adb install app-release-20251117.apk
```

### 功能不工作

**检查清单**:
1. ✅ 后端服务是否运行？
   ```bash
   # 启动后端
   cd backend
   python -m uvicorn app.main:app --reload
   ```

2. ✅ 前端是否连接到正确的后端地址？
   - 检查 `frontend/src/api/request.js` 中的 `BASE_URL`
   - 确保手机可以访问该地址

3. ✅ 网络连接是否正常？
   - 检查手机是否连接到网络
   - 检查防火墙设置

### 性能问题

**优化方案**:
1. 清除应用缓存
2. 重启应用
3. 检查手机存储空间
4. 关闭其他应用

---

## 📊 版本对比

| 版本 | 日期 | 大小 | 主要改动 |
|-----|------|------|--------|
| v1 | 2025-11-14 | 10.3 MB | 初始版本 |
| v2 | 2025-11-17 | 10.78 MB | 修复规则保存、标签过滤问题 |

---

## 📝 注意事项

1. **首次启动**: 应用可能需要几秒钟初始化
2. **权限**: 需要允许读取短信权限
3. **后端**: 确保后端服务正在运行
4. **网络**: 确保手机和电脑在同一网络上

---

## 🚀 后续步骤

1. 在手机上安装并测试APK
2. 验证三个问题是否已解决
3. 收集用户反馈
4. 根据反馈进行优化

---

## 📞 支持

如有问题，请检查:
1. 浏览器控制台错误信息
2. 后端日志
3. 网络连接
4. 应用权限设置
