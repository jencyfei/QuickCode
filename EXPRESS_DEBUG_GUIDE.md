# 快递取件码调试指南 - 2025-11-18

## 🎯 调试功能概述

快递取件码页面现已添加**调试入口**，可以查看：
1. **原始短信数据** - 程序读取的原始短信格式
2. **提取结果** - 程序从短信中提取的快递信息

---

## 📱 如何使用调试功能

### 步骤1：打开快递取件码页面
1. 打开应用
2. 进入"快递取件码"页面

### 步骤2：点击调试按钮
- 点击右上角的**设置按钮**（⚙️）
- 会弹出一个对话框，显示"调试信息 - 原始数据与提取结果"

### 步骤3：查看调试信息
对话框中会显示：
- **原始短信数据** - 前10条短信的完整内容
- **提取结果** - 从这些短信中提取的快递信息

### 步骤4：复制调试信息
- 点击"复制"按钮，将所有调试信息复制到剪贴板
- 可以粘贴到文本编辑器中查看

---

## 📊 调试信息格式说明

### 原始短信数据部分

```
=== 原始短信数据 ===
总短信数: 50

【短信 1】
发件人: 10086
内容: 【中国移动】尊敬的客户，您获得的500MB流量券还有1天即将到期...
时间: 2025-11-18T10:30:00

【短信 2】
发件人: 菜鸟驿站
内容: 【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。
时间: 2025-11-18T09:15:00
```

**字段说明**:
- **发件人** - 短信发送者（号码或名称）
- **内容** - 短信的完整内容
- **时间** - 短信接收时间（ISO 8601格式）

### 提取结果部分

```
=== 提取结果 ===
总快递数: 2

【快递 1】
快递公司: 菜鸟驿站
取件码: 6-5-5011
提取日期: 2025-11-5
地址: 郑州市北文雅小区6号楼102店
发件人: 菜鸟驿站
接收时间: 2025-11-18T09:15:00
取件状态: PENDING
原始短信: 【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。
```

**字段说明**:
- **快递公司** - 识别出的快递公司（如菜鸟驿站、SF、中通等）
- **取件码** - 提取出的取件码
- **提取日期** - 从短信中提取的日期（格式：YYYY-MM-DD）
- **地址** - 提取出的取件地点
- **发件人** - 短信发送者
- **接收时间** - 短信接收时间
- **取件状态** - 取件状态（PENDING=未取, PICKED=已取, EXPIRED=已过期）
- **原始短信** - 短信内容的前80个字符

---

## 🔍 诊断问题的方法

### 问题1：取件码识别错误

**现象**: 原始短信中的取件码是 `6-5-5011`，但提取结果中显示的是 `5011`

**诊断步骤**:
1. 打开调试信息
2. 查看"原始短信数据"中的完整短信内容
3. 查看"提取结果"中的取件码
4. 对比两者，找出差异

**可能原因**:
- 取件码提取规则不匹配
- 正则表达式优先级问题
- 短信格式与预期不符

**解决方案**:
- 查看 `ExpressExtractor.kt` 中的 `extractPickupCode()` 方法
- 检查正则表达式规则
- 添加新的规则或调整优先级

---

### 问题2：日期识别错误

**现象**: 原始短信中没有明确的日期，但提取结果中显示了错误的日期

**诊断步骤**:
1. 打开调试信息
2. 查看"原始短信数据"中是否有日期信息
3. 查看"提取结果"中的提取日期
4. 检查是否有日期提取规则匹配

**可能原因**:
- 日期提取规则不匹配
- 短信中没有明确的日期
- 日期格式与预期不符

**解决方案**:
- 查看 `ExpressExtractor.kt` 中的 `extractDate()` 方法
- 检查是否需要添加新的日期格式规则
- 考虑使用短信接收时间作为备选方案

---

### 问题3：地址识别错误

**现象**: 原始短信中有明确的地址，但提取结果中显示为"未提取"

**诊断步骤**:
1. 打开调试信息
2. 查看"原始短信数据"中的地址信息
3. 查看"提取结果"中的地址字段
4. 检查是否有地址提取规则匹配

**可能原因**:
- 地址提取规则不匹配
- 地址格式与预期不符
- 关键词不在预定义列表中

**解决方案**:
- 查看 `ExpressExtractor.kt` 中的 `extractLocation()` 方法
- 检查是否需要添加新的地址格式规则
- 添加新的关键词识别

---

### 问题4：快递公司识别错误

**现象**: 原始短信来自某个快递公司，但提取结果中没有识别出来

**诊断步骤**:
1. 打开调试信息
2. 查看"原始短信数据"中的短信内容
3. 查看"提取结果"中的快递公司字段
4. 检查是否有快递公司识别规则匹配

**可能原因**:
- 快递公司识别规则不匹配
- 快递公司关键词不在预定义列表中
- 短信格式与预期不符

**解决方案**:
- 查看 `ExpressExtractor.kt` 中的 `detectExpressCompany()` 方法
- 添加新的快递公司关键词
- 调整关键词匹配规则

---

## 📋 完整的调试信息示例

```
=== 原始短信数据 ===
总短信数: 3

【短信 1】
发件人: 菜鸟驿站
内容: 【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。
时间: 2025-11-18T09:15:00

【短信 2】
发件人: SF
内容: 【顺丰快递】您的包裹已到达，取件码：2-4-2029，请到郑州市中原区取件。
时间: 2025-11-18T08:30:00

【短信 3】
发件人: 中通
内容: 【中通快递】您有1个包裹在中通驿站，凭9-6-3012到郑州市金水区中通驿站取件。
时间: 2025-11-18T07:45:00

=== 提取结果 ===
总快递数: 3

【快递 1】
快递公司: 菜鸟驿站
取件码: 6-5-5011
提取日期: 2025-11-5
地址: 郑州市北文雅小区6号楼102店
发件人: 菜鸟驿站
接收时间: 2025-11-18T09:15:00
取件状态: PENDING
原始短信: 【菜鸟驿站】您的包裹已到站，凭6-5-5011到郑州市北文雅小区6号楼102店取件。

【快递 2】
快递公司: SF
取件码: 2-4-2029
提取日期: 2025-11-4
地址: 郑州市中原区
发件人: SF
接收时间: 2025-11-18T08:30:00
取件状态: PENDING
原始短信: 【顺丰快递】您的包裹已到达，取件码：2-4-2029，请到郑州市中原区取件。

【快递 3】
快递公司: 中通
取件码: 9-6-3012
提取日期: 2025-11-6
地址: 郑州市金水区中通驿站
发件人: 中通
接收时间: 2025-11-18T07:45:00
取件状态: PENDING
原始短信: 【中通快递】您有1个包裹在中通驿站，凭9-6-3012到郑州市金水区中通驿站取件。
```

---

## 🛠️ 如何修复识别问题

### 修复取件码识别

**文件**: `ExpressExtractor.kt`

**方法**: `extractPickupCode()` 或 `extractAllPickupCodes()`

**步骤**:
1. 打开调试信息，找到错误的短信
2. 复制短信内容
3. 在 `ExpressExtractor.kt` 中找到相应的提取方法
4. 添加新的正则表达式规则
5. 测试新规则
6. 重新编译应用

### 修复日期识别

**文件**: `ExpressExtractor.kt`

**方法**: `extractDate()`

**步骤**:
1. 打开调试信息，找到错误的短信
2. 查看短信中的日期格式
3. 在 `extractDate()` 方法中添加新的日期格式规则
4. 测试新规则
5. 重新编译应用

### 修复地址识别

**文件**: `ExpressExtractor.kt`

**方法**: `extractLocation()`

**步骤**:
1. 打开调试信息，找到错误的短信
2. 查看短信中的地址格式
3. 在 `extractLocation()` 方法中添加新的地址格式规则
4. 测试新规则
5. 重新编译应用

---

## 📝 调试信息导出

### 导出到文本文件

1. 打开调试信息对话框
2. 点击"复制"按钮
3. 打开文本编辑器（如记事本）
4. 粘贴调试信息
5. 保存为 `.txt` 文件

### 导出到邮件

1. 打开调试信息对话框
2. 点击"复制"按钮
3. 打开邮件应用
4. 粘贴调试信息到邮件正文
5. 发送给开发者

---

## 🎯 常见问题

### Q: 调试信息太长，无法全部显示？
A: 调试对话框支持滚动，可以向上/向下滑动查看更多内容。或者点击"复制"按钮，将所有信息复制到文本编辑器中查看。

### Q: 如何清除调试信息？
A: 关闭调试对话框后，下次打开时会重新生成最新的调试信息。

### Q: 调试信息中显示的短信数量和快递数量不一致？
A: 这是正常的。一条短信可能包含多个快递信息（多个取件码），或者一条短信不包含任何快递信息。

### Q: 如何根据调试信息修复识别问题？
A: 查看上面的"如何修复识别问题"章节，根据具体问题选择相应的修复方法。

---

## 📌 总结

调试功能提供了以下能力：
- ✅ 查看程序读取的原始短信数据
- ✅ 查看程序提取的快递信息
- ✅ 对比原始数据和提取结果，诊断问题
- ✅ 导出调试信息用于分析
- ✅ 快速定位识别错误的原因

通过这个调试功能，可以快速诊断和修复取件码识别问题。

