# Gradle 缓存清理指南

## 一、分析结果

根据检查，你的Gradle缓存目录 `C:\Users\Administrator\.gradle\caches` 总共占用约 **6.37GB** 空间。

### 1.1 各子目录占用情况

| 目录 | 大小 | 说明 |
|------|------|------|
| **8.11.1** | 1.14 GB | Gradle 8.11.1版本文件 |
| **8.12** | 1.12 GB | Gradle 8.12版本文件 |
| **modules-2** | 1.12 GB | 依赖库缓存（重要） |
| **8.13** | 1.00 GB | Gradle 8.13版本文件 |
| **transforms-3** | 0.92 GB | 转换缓存（可清理） |
| **build-cache-1** | 0.65 GB | 构建缓存（可清理） |
| **jars-9** | 0.40 GB | JAR文件缓存 |
| **其他** | 少量 | 其他缓存文件 |

### 1.2 当前项目使用的Gradle版本

根据 `android/gradle/wrapper/gradle-wrapper.properties`，当前项目使用：
- **Gradle 8.0**

但缓存目录中有多个版本的Gradle（8.11.1、8.12、8.13），这些都是**不需要的**。

## 二、Gradle缓存目录说明

### 2.1 目录结构和作用

```
.gradle/
├── caches/                    # 缓存目录
│   ├── X.X.X/                # Gradle版本文件（可删除不需要的版本）
│   ├── modules-2/            # 依赖库缓存（重要，但可清理旧版本）
│   ├── transforms-3/         # 转换缓存（可安全删除）
│   ├── build-cache-1/        # 构建缓存（可安全删除）
│   └── jars-9/               # JAR文件缓存
├── daemon/                    # Gradle守护进程
├── wrapper/                   # Gradle Wrapper文件
└── ...
```

### 2.2 各目录的作用和删除影响

| 目录 | 作用 | 可否删除 | 删除影响 |
|------|------|----------|----------|
| **caches/X.X.X/** | Gradle版本文件 | ✅ 可删除不需要的版本 | 删除后需要重新下载对应版本 |
| **modules-2/** | 依赖库缓存 | ⚠️ 可清理旧版本 | 删除后构建时需要重新下载依赖 |
| **transforms-3/** | 转换缓存 | ✅ 可安全删除 | 删除后重新构建时会重新转换 |
| **build-cache-1/** | 构建缓存 | ✅ 可安全删除 | 删除后构建时不会使用缓存，速度稍慢 |
| **jars-9/** | JAR文件缓存 | ⚠️ 可清理 | 删除后需要重新下载JAR |

## 三、清理建议

### 3.1 安全清理方案（推荐）

**可以安全删除的内容**：

1. **不需要的Gradle版本**（可节省约3-4GB）
   - 项目使用Gradle 8.0
   - 可以删除：8.11.1、8.12、8.13等其他版本

2. **构建缓存**（可节省约0.65GB）
   - `build-cache-1/` 目录可以安全删除
   - 删除后首次构建会稍慢，后续构建会重新生成

3. **转换缓存**（可节省约0.92GB）
   - `transforms-3/` 目录可以安全删除
   - 删除后首次构建会重新转换

**总计可安全清理约 4.5-5GB 空间**

### 3.2 谨慎清理方案

**需要谨慎清理的内容**：

1. **依赖库缓存**（`modules-2/`，约1.12GB）
   - 可以清理，但删除后首次构建需要重新下载所有依赖
   - 如果网络不好，可能会很慢
   - **建议**：如果空间充足，建议保留

2. **JAR文件缓存**（`jars-9/`，约0.40GB）
   - 可以清理，影响同上
   - **建议**：如果空间充足，建议保留

## 四、清理方法

### 4.1 使用Gradle命令清理（推荐）

#### 方法一：清理所有缓存（最彻底）

```powershell
# 停止所有Gradle守护进程
cd android
.\gradlew.bat --stop

# 清理构建缓存和转换缓存
.\gradlew.bat clean --no-build-cache
```

#### 方法二：使用Gradle官方清理命令

```powershell
# 清理所有缓存（不包括依赖库）
cd android
.\gradlew.bat cleanBuildCache

# 或者手动清理
.\gradlew.bat --no-build-cache clean
```

### 4.2 手动清理（精确控制）

可以使用提供的清理脚本，精确删除不需要的版本和缓存。

### 4.3 使用PowerShell脚本清理

我已经为你创建了一个自动化清理脚本，可以：

1. **自动识别当前项目使用的Gradle版本**
2. **删除不需要的Gradle版本**
3. **清理构建缓存和转换缓存**
4. **保留依赖库缓存（可选）**

运行脚本：`.\scripts\cleanup_gradle_cache.ps1`

## 五、清理后影响

### 5.1 首次构建

清理后，首次构建会：
- ✅ 重新下载使用的Gradle版本（如果需要）
- ✅ 重新下载项目依赖（如果清理了modules-2）
- ⏱️ 构建时间会稍长（但只影响首次）

### 5.2 后续构建

- ✅ 后续构建速度不受影响
- ✅ 缓存会重新生成
- ✅ 功能完全正常

## 六、定期清理建议

### 6.1 何时清理

- **磁盘空间不足时**：优先清理
- **换项目时**：可以清理不需要的版本
- **定期维护**：建议每3-6个月清理一次

### 6.2 清理频率

- **构建缓存**：可以每周清理一次（不影响项目）
- **转换缓存**：可以每月清理一次
- **Gradle版本**：只在不需要的版本占用空间时清理
- **依赖库缓存**：不建议频繁清理（影响构建速度）

## 七、预防措施

### 7.1 减少缓存占用

1. **使用Gradle Wrapper**：确保项目使用固定版本的Gradle
2. **配置缓存大小**：在 `gradle.properties` 中配置：
   ```properties
   # 限制构建缓存大小（可选）
   org.gradle.cache.cleanup=true
   ```

### 7.2 定期清理脚本

可以设置定时任务，定期运行清理脚本。

## 八、常见问题

### Q1: 删除缓存后，项目无法构建？

**A**: 这是正常的，首次构建会重新下载依赖。如果网络有问题，可能需要：
- 配置国内镜像源（Maven仓库）
- 使用代理
- 等待下载完成

### Q2: 哪些缓存绝对不能删除？

**A**: 
- **Gradle Wrapper**（`.gradle/wrapper/`）：不要删除
- **当前项目使用的Gradle版本**：不要删除
- **正在使用的依赖库**：建议保留

### Q3: 清理后能节省多少空间？

**A**: 
- **最小清理**：约2GB（只删除不需要的Gradle版本）
- **推荐清理**：约4.5GB（删除不需要版本+构建缓存）
- **彻底清理**：约6GB（包括依赖库缓存）

### Q4: 清理缓存会影响项目吗？

**A**: 不会影响项目功能，只会：
- 首次构建时间稍长
- 需要重新下载依赖（如果清理了modules-2）

## 九、总结

**可以删除**：✅
- 不需要的Gradle版本（8.11.1、8.12、8.13等，项目使用8.0）
- 构建缓存（build-cache-1）
- 转换缓存（transforms-3）

**建议保留**：⚠️
- 当前项目使用的Gradle版本（8.0）
- 依赖库缓存（modules-2），如果空间充足
- JAR文件缓存（jars-9）

**预计可节省空间**：**约4.5-5GB**

---

**清理脚本位置**：`scripts/cleanup_gradle_cache.ps1`  
**使用方法**：参考脚本内的说明

