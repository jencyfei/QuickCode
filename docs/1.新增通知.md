下面提供一份 **程序员可直接拿去实现** 的《新增功能需求文档》。结构清晰、可交付、无废话，适合你作为产品经理直接发给开发。

---

# 📘《短信取件码 App — 横幅通知功能新增需求文档》

## 一、功能背景

当前 App 已具备读取短信内容并识别快递取件码的能力，但缺少 **实时通知能力**。
为提升用户体验，需要在新快递短信到来时，自动触发 **横幅通知（Heads-up Notification）**，帮助用户第一时间获知取件码。

---

## 二、功能目标（必须实现）

当新短信中包含取件码时，App 能够：

1. **自动识别短信内容**（无需用户打开 App）
2. **实时触发顶部横幅通知 + 通知栏消息**
3. 通知内容清晰展示：

   * 快递类型（如：京东、顺丰、菜鸟等）
   * 取件码（如：1234）
   * 可选：快递图标
4. 用户点击通知后，可打开 App 查看取件码详情。

---

## 三、实现范围

### ① 新增短信监听模块（必须）

通过 **BroadcastReceiver** 监听系统 SMS_RECEIVED 广播。

* 不需要成为默认短信应用
* 收到短信后在后台解析内容

### ② 新增取件码解析触发逻辑（复用现有识别算法）

进入 Receiver 后自动调用已有的识别模块：

* 使用已有正则提取取件码
* 识别快递来源
* 生成通知所需的结构化数据（如 type、code、sender）

### ③ 新增通知渠道（必须）

创建名称为 **快递提醒** 的通知渠道，要求：

* Channel ID：`express_channel`
* Importance：`IMPORTANCE_HIGH`（确保横幅）
* 默认开启声音、震动

### ④ 新增横幅通知构建逻辑

构建通知包含以下内容：

* 通知标题：`新快递提醒`
* 通知正文：如 `京东：取件码 1234`
* 小图标：使用 App logo 或快递图标
* 优先级：`PRIORITY_MAX`（确保弹出横幅）
* 点击通知 → 打开 App 主页面（或取件码详情页）

### ⑤ 新增去重机制（必须）

避免同一个短信反复触发通知。

去重方式采用其中之一（任选其一即可）：

* 记录最近一次处理的短信时间戳
* 或对短信内容做 hash，缓存最近 N 条

---

## 四、可选拓展功能（如时间充足可做）

### 1. 快递图标自动匹配

根据短信来源（京东/顺丰/菜鸟等）展示不同图标。

### 2. 通知快捷操作

横幅上加入动作：

* “复制取件码”
* “查看详情”

### 3. 多条快递合并通知

若短时间多条短信，使用 InboxStyle 合并显示。

---

## 五、UI/交互要求

### 1. 通知样式（程序员可自由发挥）

**横幅通知内容建议结构：**

标题：

* `新快递提醒`

正文格式：

* `{快递类型}：取件码 {code}`
  例如：
* `顺丰：取件码 8492`

图标：

* 使用 App 的 icon 或匹配快递类型的小图标

动作：

* 点击后打开 App

---

## 六、权限需求（必须）

在 AndroidManifest 中确保声明：

```xml
<uses-permission android:name="android.permission.RECEIVE_SMS"/>
<uses-permission android:name="android.permission.READ_SMS"/>
```

App 内需要在合适流程中引导用户授权读取短信。

---

## 七、设置页面新增内容（必须）

在 App 的“设置/权限说明”增加一个开关项：

**【通知权限引导】**

* 跳转到系统通知设置页
* 提示用户开启“允许横幅通知”

---

## 八、兼容要求

* Android 6.0 – Android 14
* 各大厂商需确认横幅权限：

  * MIUI
  * 华为 / 鸿蒙
  * OPPO / Realme
  * Vivo

（程序仅需实现跳转设置页，不强制兼容策略）

---

## 九、触发流程图（给开发参考）

```
短信收到
   ↓
SMS Receiver 捕获短信
   ↓
解析短信 → 识别取件码
   ↓
是否包含取件码？
   → 否：结束
   → 是：继续
   ↓
去重检查
   → 重复：结束
   → 非重复：继续
   ↓
构建通知内容
   ↓
触发高优先级横幅通知
```

---

## 十、验收标准（非常关键）

1. 来短信后 1 秒内触发横幅通知
2. 任何机型只要通知权限开启，就能看到横幅
3. 不重复弹同一条短信
4. 点击通知可正常打开 App
5. 通知展示内容完整：快递类型 + 取件码

---

如果你需要，我可以继续帮你：
✔ 提供 **代码框架示例（Kotlin/Java 都可以）**
✔ 输出一份 **开发者任务拆解清单（可直接安排排期）**
✔ 针对不同机型整理 **通知权限引导文案 + 跳转路径**

告诉我是否需要哪部分？
