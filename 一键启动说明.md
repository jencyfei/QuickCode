# 🚀 一键启动脚本使用说明

## ✅ 问题已修复

已修复 `ModuleNotFoundError: No module named 'app'` 错误。

**修复内容：**
- ✅ 修正了工作目录路径
- ✅ 添加了必需的环境变量
- ✅ 移除了对 venv 的依赖（直接使用系统 Python）
- ✅ 支持多端口前端服务（3000/3001/3002）

---

## 🎯 使用方法

### 方法1：一键启动（推荐）

**双击运行：`start_all.bat`**

这个脚本会自动：
1. ✅ 检查并释放端口占用
2. ✅ 设置环境变量
3. ✅ 启动后端服务（10043端口）
4. ✅ 启动前端服务（3000端口，如占用会自动切换）
5. ✅ 打开两个服务窗口

**启动后：**
- 🔧 后端：http://localhost:10043
- 📱 前端：http://localhost:3000（或3001/3002，查看前端窗口输出）
- 📚 API文档：http://localhost:10043/docs

**登录信息：**
- 📧 邮箱：`test@example.com`
- 🔑 密码：`test123`

### 方法2：停止所有服务

**双击运行：`stop_all.bat`**

这个脚本会：
1. 停止后端服务（10043端口）
2. 停止前端服务（3000/3001/3002端口）
3. 清理残留进程

### 方法3：单独启动

如果想单独启动服务：

**后端：**
```
双击：scripts\start_backend_simple.bat
```

**前端：**
```
双击：scripts\start_frontend.bat
```

---

## 📋 启动检查清单

### 启动前检查

- [ ] PostgreSQL 服务运行中
- [ ] 端口 10043 未被占用
- [ ] 端口 3000 未被占用（或可切换）

### 启动后验证

1. **后端检查：**
   - 访问 http://localhost:10043/docs
   - 应该能看到 API 文档页面

2. **前端检查：**
   - 查看前端窗口输出，找到实际运行端口
   - 例如：`Local: http://localhost:3002/`
   - 访问该地址

3. **登录测试：**
   - 使用 test@example.com / test123 登录
   - 应该能看到短信列表

---

## 🔧 常见问题

### 问题1：后端启动失败

**错误：ModuleNotFoundError: No module named 'app'**

✅ 已修复！如仍出现，请：
1. 确认在项目根目录运行脚本
2. 检查 backend 目录是否存在

**错误：数据库连接失败**

解决方法：
1. 确认 PostgreSQL 服务运行
2. 检查数据库配置：
   - 主机：localhost
   - 端口：5432
   - 数据库：sms_tagger
   - 用户名：postgres
   - 密码：123123

### 问题2：端口被占用

**解决方法：**
1. 运行 `stop_all.bat` 停止所有服务
2. 或手动释放端口：
```powershell
# 查找占用进程
netstat -ano | findstr "10043"
netstat -ano | findstr "3000"

# 终止进程
taskkill /F /PID <进程ID>
```

### 问题3：前端显示"暂无标签"

**原因：** 数据未加载或后端未连接

**解决方法：**
1. 确认后端正常运行
2. 运行数据恢复脚本：
```powershell
cd D:\tools\python\mypro\sms_agent
$env:DATABASE_URL="postgresql://postgres:123123@localhost:5432/sms_tagger"
$env:SECRET_KEY="your-super-secret-key"
python scripts\quick_fix.py
```

---

## 📊 服务窗口说明

### 后端窗口

**正常启动应显示：**
```
INFO:     Uvicorn running on http://0.0.0.0:10043
INFO:     Application startup complete.
```

**如果看到错误：**
- 检查数据库连接
- 查看错误信息
- 确认环境变量设置

### 前端窗口

**正常启动应显示：**
```
VITE v7.x.x  ready in XXX ms
➜  Local:   http://localhost:3000/
```

**端口自动切换：**
```
Port 3000 is in use, trying another one...
➜  Local:   http://localhost:3001/
```

---

## 🎯 快速测试

### 测试后端

```powershell
# PowerShell 中运行
Invoke-WebRequest -Uri "http://localhost:10043/health" -UseBasicParsing
```

**预期结果：** StatusCode 200

### 测试前端

浏览器访问：http://localhost:3000（或实际端口）

**预期结果：** 看到登录页面

---

## 💡 使用建议

### 日常使用

1. **每次使用：**
   - 双击 `start_all.bat`
   - 等待两个窗口打开
   - 访问前端地址
   - 使用完毕后运行 `stop_all.bat`

2. **开发调试：**
   - 单独启动后端和前端
   - 可以在代码编辑器中查看日志
   - 支持热重载

### 数据备份

定期运行数据恢复脚本保存当前数据：
```powershell
python scripts\quick_fix.py
```

---

## 📞 技术支持

### 相关文档

- `问题解决完成.md` - 问题修复详情
- `使用指南.md` - 系统使用指南
- `docs/QUICK_START_GUIDE.md` - 快速启动指南

### 脚本位置

- `start_all.bat` - 一键启动（已修复）✅
- `stop_all.bat` - 停止服务（已优化）✅
- `scripts/start_backend_simple.bat` - 单独启动后端
- `scripts/start_frontend.bat` - 单独启动前端
- `scripts/quick_fix.py` - 数据恢复

---

## ✨ 更新日志

### 2025-11-07

**修复内容：**
- ✅ 修复 `ModuleNotFoundError: No module named 'app'`
- ✅ 添加环境变量自动设置
- ✅ 移除 venv 依赖
- ✅ 支持多端口前端
- ✅ 优化停止脚本
- ✅ 添加登录信息提示

**现在可以正常使用了！** 🎉

---

**现在请双击运行 `start_all.bat` 开始使用！** 🚀

