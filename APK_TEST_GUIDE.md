# APK 测试安装指南

## 📦 APK 文件信息

**文件路径**：`android/app/build/outputs/apk/debug/app-debug.apk`

**文件名**：`app-debug.apk`

**构建时间**：2025-11-17

**版本**：Debug 版本（用于测试）

---

## 🚀 安装方法

### 方法 1：使用 ADB 安装（推荐）

**前置条件**：
- 已安装 Android SDK Platform Tools
- 手机已连接到电脑
- 手机已启用开发者模式和 USB 调试

**安装步骤**：

```bash
# 进入 android 目录
cd D:\tools\python\mypro\sms_agent\android

# 安装 APK
adb install app/build/outputs/apk/debug/app-debug.apk

# 或者卸载后重新安装
adb uninstall com.sms.tagger
adb install app/build/outputs/apk/debug/app-debug.apk
```

### 方法 2：直接传输安装

1. 将 `app-debug.apk` 复制到手机
2. 使用文件管理器打开 APK 文件
3. 点击"安装"按钮

### 方法 3：使用 Android Studio

1. 打开 Android Studio
2. 选择 "Run" → "Run 'app'"
3. 选择目标设备
4. 点击 "OK" 安装并运行

---

## ✅ 测试清单

### 问题 1：标题重复
- [ ] 打开快递页面，检查"快递取件码"标题是否只显示一次

### 问题 2：地址重复
- [ ] 检查每个快递卡片中的地址是否只显示一次
- [ ] 验证地址信息与地点名称不重复

### 问题 3：按钮功能
- [ ] 点击"复制全部"按钮，检查是否复制了所有取件码
- [ ] 点击"全部已取"按钮，检查状态是否更新
- [ ] 点击单个快递的"复制"按钮，检查是否复制了该取件码

### 问题 4：取件日期
- [ ] 查看菜鸟驿站快递的取件日期
- [ ] 验证日期格式是否为 "月-日-年"（例如：2-4-2029）
- [ ] 检查其他快递的日期格式是否正确

### 问题 5：接收时间
- [ ] 检查接收时间是否只显示时分秒（例如：10:35:45）
- [ ] 验证不显示日期部分

### 问题 6：规则配置入口
- [ ] 在快递页面右上角找到设置按钮（⚙️）
- [ ] 点击设置按钮，进入规则管理页面
- [ ] 验证能看到"菜鸟驿站取件码"内置规则
- [ ] 检查内置规则是否显示为"不可编辑"

---

## 📋 权限检查

首次运行应用时，会请求以下权限：

- **READ_SMS**：读取短信（必需）
- **RECEIVE_SMS**：接收短信（必需）

**操作步骤**：
1. 应用启动时会弹出权限请求对话框
2. 点击"允许"授予权限
3. 如果之前拒绝了，可在设置中手动授予

---

## 🔧 常见问题

### Q1：安装失败，提示"应用已安装"
**解决方案**：
```bash
adb uninstall com.sms.tagger
adb install app/build/outputs/apk/debug/app-debug.apk
```

### Q2：无法读取短信
**解决方案**：
1. 进入手机设置
2. 找到应用权限设置
3. 为"短信助手"应用授予 READ_SMS 权限
4. 重启应用

### Q3：快递信息为空
**解决方案**：
1. 确保手机中有快递相关的短信
2. 检查短信是否来自快递公司（菜鸟驿站、顺丰、中通等）
3. 重启应用，重新加载短信

### Q4：应用闪退
**解决方案**：
1. 检查 logcat 输出获取错误信息
2. 确保已授予所有必需权限
3. 尝试卸载后重新安装

---

## 📊 测试报告

测试完成后，请记录以下信息：

```
测试设备：[手机型号]
Android 版本：[版本号]
测试时间：[日期]

问题 1 - 标题重复：[✓/✗]
问题 2 - 地址重复：[✓/✗]
问题 3 - 按钮功能：[✓/✗]
问题 4 - 取件日期：[✓/✗]
问题 5 - 接收时间：[✓/✗]
问题 6 - 规则配置：[✓/✗]

其他发现的问题：
- [问题描述]
- [问题描述]
```

---

## 🔄 重新构建

如果需要重新构建 APK（修改代码后）：

```bash
cd D:\tools\python\mypro\sms_agent\android

# 清理构建
.\gradlew.bat clean

# 构建 Debug APK
.\gradlew.bat assembleDebug --no-daemon -x lint

# 或者直接运行（如果连接了设备）
.\gradlew.bat installDebug --no-daemon -x lint
```

---

## 📝 构建信息

- **构建工具**：Gradle 8.0
- **编译 SDK**：Android 14
- **最小 SDK**：Android 8.0 (API 26)
- **目标 SDK**：Android 14 (API 34)
- **Kotlin 版本**：1.9.x
- **Compose 版本**：1.5.x

---

## ✨ 新增功能说明

### 1. 菜鸟驿站取件码规则
- **自动识别**：检测到"【菜鸟驿站】"标记时自动提取取件码
- **提取逻辑**：在"凭"字之后提取 8 个字符
- **示例**：
  ```
  【菜鸟驿站】您的包裹已到站，凭12345678取件。
  → 提取码：12345678
  ```

### 2. 日期格式优化
- **菜鸟驿站格式**：`月-日-年`（例如：2-4-2029）
- **其他快递格式**：保持原有格式

### 3. 时间显示优化
- **接收时间**：仅显示时分秒（例如：10:35:45）
- **不显示日期**：避免冗余信息

### 4. 规则管理入口
- **位置**：快递页面右上角设置按钮
- **功能**：查看和管理取件码提取规则
- **内置规则**：显示为只读，不可编辑

---

## 📞 技术支持

如遇到问题，请检查：
1. 构建日志中是否有错误信息
2. 手机权限设置是否正确
3. 短信内容是否符合识别规则
4. 应用版本是否为最新

---

**最后更新**：2025-11-17  
**状态**：✅ 可用于测试
