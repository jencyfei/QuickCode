# 自定义打标规则使用指南

## 快速开始

### 访问规则管理
1. 打开应用 → 点击底部导航栏 **"标签"** (🏷️)
2. 在标签管理页面，点击右上角 **"⚙️"** 设置按钮
3. 进入规则管理页面

### 添加新规则
1. 点击右下角 **"+"** 按钮
2. 填写规则信息
3. 点击 **"保存"** 按钮

## 规则类型

### 1️⃣ 发信人规则 (SENDER)

**用途**: 根据发信人信息进行分类和提取

**条件格式**: `条件类型|关键词`

**条件类型**:
- `contains|关键词` - 发信人包含指定关键词
- `startsWith|关键词` - 发信人以指定关键词开头
- `endsWith|关键词` - 发信人以指定关键词结尾

**示例**:
```
规则名称: 菜鸟驿站提醒
标签名称: 快递
规则类型: 发信人
条件关键词: contains|菜鸟
提取位置: 取件码
提取长度: 6
```

### 2️⃣ 短信内容规则 (CONTENT)

**用途**: 根据短信内容进行分类和提取

**工作流程**:
1. 检查短信内容是否包含条件关键词
2. 如果包含，从提取位置之后提取指定长度的字符

**示例**:
```
规则名称: 快递取件码
标签名称: 快递
规则类型: 短信内容
条件关键词: 取件码
提取位置: 取件码
提取长度: 6
```

## 常用规则模板

### 快递相关

#### 快递取件码提取
```
规则名称: 快递取件码
标签名称: 快递
规则类型: 短信内容
条件关键词: 取件码
提取位置: 取件码
提取长度: 6
```

#### 菜鸟驿站提醒
```
规则名称: 菜鸟驿站
标签名称: 快递
规则类型: 发信人
条件关键词: contains|菜鸟
提取位置: 取件码
提取长度: 4
```

### 银行相关

#### 银行转账提醒
```
规则名称: 银行转账
标签名称: 银行
规则类型: 短信内容
条件关键词: 转账
提取位置: 金额
提取长度: 8
```

#### 银行消费提醒
```
规则名称: 银行消费
标签名称: 银行
规则类型: 发信人
条件关键词: contains|银行
提取位置: 消费
提取长度: 6
```

### 验证码相关

#### 验证码提取
```
规则名称: 验证码
标签名称: 验证码
规则类型: 短信内容
条件关键词: 验证码
提取位置: 验证码
提取长度: 6
```

## 规则管理操作

### 编辑规则
1. 在规则卡片上点击 **"编辑"** 按钮
2. 修改规则信息
3. 点击 **"保存"** 按钮

### 删除规则
1. 在规则卡片上点击 **"删除"** 按钮
2. 规则将被立即删除

### 启用/禁用规则
1. 在规则卡片上找到 **"开关"** 按钮
2. 点击开关启用或禁用规则
3. 禁用的规则不会被执行

## 提取位置说明

**提取位置** 是指从哪个关键词之后开始提取字符。

**示例**:
- 短信内容: "您的快递已到达，取件码：123456，请在24小时内取件"
- 提取位置: `取件码：`
- 提取长度: `6`
- 结果: `123456`

## 提取长度说明

**提取长度** 是指从提取位置之后提取多少个字符。

**常见长度**:
- 验证码: 4-6 个字符
- 快递取件码: 4-8 个字符
- 金额: 6-10 个字符
- 订单号: 10-20 个字符

## 规则优先级

- 规则按优先级从高到低执行
- 默认优先级相同，按添加顺序执行
- 后续版本支持手动调整优先级

## 常见问题

### Q: 规则不生效怎么办？
A: 检查以下几点：
1. 规则是否启用（开关是否打开）
2. 条件关键词是否正确
3. 提取位置是否存在于短信中
4. 提取长度是否合理

### Q: 如何测试规则？
A: 目前需要手动查看短信列表验证。后续版本将支持规则预览功能。

### Q: 可以添加多少个规则？
A: 没有限制，但过多的规则可能影响性能。建议不超过 50 个。

### Q: 规则数据会保存吗？
A: 目前规则保存在内存中，应用重启后会丢失。后续版本将集成本地数据库持久化。

## 技术细节

### 规则执行流程
1. 读取所有启用的规则
2. 按优先级排序
3. 逐个执行规则
4. 返回匹配结果和提取的值

### 提取算法
```
1. 在文本中查找提取位置关键词
2. 如果找到，从关键词末尾开始计数
3. 提取指定长度的字符
4. 返回提取结果
```

## 后续计划

- [ ] 规则数据库持久化（Room）
- [ ] 规则优先级拖拽调整
- [ ] 规则模板库
- [ ] 规则导入/导出
- [ ] 规则测试预览
- [ ] 与自动分类集成
- [ ] 规则分享功能
